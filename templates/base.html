<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Asset Compliance Manager{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- GLOBAL LOADING OVERLAY -->
<div id="global-loader" class="loader-overlay hidden">
    <div class="infinity-loader"></div>
    <div class="loader-text">Evaluating Reminders…</div>
</div>

<nav class="top-nav">
    <!-- LEFT -->
    <div class="nav-left">
        <span class="logo">ACM</span>
    </div>

    <!-- CENTER -->
    <div class="nav-center">
        <a href="{{ url_for('asset_master') }}">Asset Master</a>
        <a href="{{ url_for('scrap_asset') }}">Scrap</a>
        <a href="{{ url_for('amc_create') }}">AMC</a>
        <a href="{{ url_for('calibration') }}">Calibration</a>
        <a href="{{ url_for('history') }}">History</a>
        <a href="{{ url_for('reminders') }}" class="active">Reminders</a>
    </div>

    <!-- RIGHT -->
    <div class="nav-right">
        <a href="{{ url_for('backup') }}" class="backup-btn">Backup</a>

        <button class="hamburger" onclick="toggleMenu()">☰</button>

        <div id="hamburgerMenu" class="hamburger-menu">
            <div class="menu-user">
                {{ session.username }}
            </div>

            <a href="{{ url_for('change_password') }}">Change Password</a>

            {% if session.role == "developer" %}
                <hr>
                <a href="{{ url_for('reset_password') }}" class="danger-link">
                    Reset Password (Dev)
                </a>
            {% endif %}

            <hr>
            <a href="{{ url_for('logout') }}" class="logout">Logout</a>
        </div>
    </div>
</nav>


<!-- MAIN CONTENT -->
<main class="main-container page-animate">

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% if request.path.startswith('/history') %}
    <div class="history-toggle">
        <a href="{{ url_for('history') }}"
        class="toggle-btn {% if request.path == '/history' %}active{% endif %}">
            AMC History
        </a>

        <a href="{{ url_for('history_calibration_list') }}"
        class="toggle-btn {% if request.path.startswith('/history/calibration') %}active{% endif %}">
            Calibration History
        </a>
    </div>
    {% endif %}


    {% block content %}{% endblock %}

</main>

<script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

<script>
function toggleMenu() {
    const menu = document.getElementById("hamburgerMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}

document.addEventListener("click", function (e) {
    const menu = document.getElementById("hamburgerMenu");
    const button = document.querySelector(".hamburger");

    if (!menu || !button) return;

    if (!menu.contains(e.target) && !button.contains(e.target)) {
        menu.style.display = "none";
    }
});

window.showGlobalLoader = function () {
    document.getElementById("global-loader")?.classList.remove("hidden");
};

window.hideGlobalLoader = function () {
    document.getElementById("global-loader")?.classList.add("hidden");
};
</script>

</body>
</html>

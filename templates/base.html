<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Asset Compliance Manager{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body>

<div id="global-loader" class="loader-overlay hidden">
    <div class="infinity-loader"></div>
    <div class="loader-text">Evaluating Reminders…</div>
</div>

<nav class="top-nav">
    <div class="nav-left">
        <span class="logo">ACM</span>
    </div>

    <div class="nav-center">
        <a href="{{ url_for('asset_master') }}">Asset Master</a>
        <a href="{{ url_for('scrap_asset') }}">Scrap</a>
        <a href="{{ url_for('amc_create') }}">AMC</a>
        <a href="{{ url_for('calibration') }}">Calibration</a>
        <a href="{{ url_for('history') }}">History</a>
        <a href="{{ url_for('reminders') }}" class="active">Reminders</a>
    </div>

    <div class="nav-right">
        <a href="{{ url_for('backup') }}" class="backup-btn">Backup</a>

        <button class="hamburger" id="hamburgerBtn" type="button">☰</button>

        <div id="hamburgerMenu" class="hamburger-menu">
            <div class="menu-user">
                {{ session.username }}
            </div>

            <a href="{{ url_for('change_password') }}">Change Password</a>

            {% if session.role == "developer" %}
                <hr>
                <a href="{{ url_for('reset_password') }}" class="danger-link">
                    Reset Password (Dev)
                </a>
            {% endif %}

            <hr>
            <a href="{{ url_for('logout') }}" class="logout">Logout</a>
        </div>
    </div>
</nav>

<main class="main-container page-animate">

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% if request.path.startswith('/history') %}
    <div class="history-toggle">
        <a href="{{ url_for('history') }}"
        class="toggle-btn {% if request.path == '/history' %}active{% endif %}">
            AMC History
        </a>

        <a href="{{ url_for('history_calibration_list') }}"
        class="toggle-btn {% if request.path.startswith('/history/calibration') %}active{% endif %}">
            Calibration History
        </a>

        <a href="{{ url_for('history_scrap_list') }}"
        class="toggle-btn {% if request.path.startswith('/history/scrap') %}active{% endif %}">
            Scrap History
        </a>
    </div>
    {% endif %}

    {% block content %}{% endblock %}

</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const btn = document.getElementById("hamburgerBtn");
    const menu = document.getElementById("hamburgerMenu");

    if (btn && menu) {
        btn.addEventListener("click", function () {
            menu.style.display = (menu.style.display === "block") ? "none" : "block";
        });

        document.addEventListener("click", function (e) {
            if (!menu.contains(e.target) && !btn.contains(e.target)) {
                menu.style.display = "none";
            }
        });

        document.addEventListener("keydown", function (e) {
            if (e.key === "Escape") {
                menu.style.display = "none";
            }
        });
    }

    if (window.jQuery && $(".searchable-select").length) {
        $(".searchable-select").select2({
            width: "100%",
            placeholder: "Search...",
            allowClear: true
        });
    }
});

window.showGlobalLoader = function () {
    document.getElementById("global-loader")?.classList.remove("hidden");
};

window.hideGlobalLoader = function () {
    document.getElementById("global-loader")?.classList.add("hidden");
};
</script>

</body>
</html>

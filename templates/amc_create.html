{% extends "base.html" %}
{% block content %}

<div class="card header-card">
    <div class="header-left">
        <h1>AMC Management</h1>
        <div class="muted-text">Create Annual Maintenance Contract</div>
    </div>
</div>

<div class="card form-card amc-create-card">
    <h3>Create AMC</h3>

    <form method="POST" class="asset-form">
        <div class="form-grid">

            <div class="form-group">
                <label>Asset</label>
                <select name="asset_id" class="searchable-select" required>
                    <option value="">Select Asset</option>
                    {% for asset in assets %}
                        <option value="{{ asset.id }}">
                            {{ asset.asset_code }} — {{ asset.asset_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label>Start Date</label>
                <input type="date" name="start_date" required>
            </div>

            <div class="form-group">
                <label>End Date</label>
                <input type="date" name="end_date" required>
            </div>

            <div class="form-group">
                <label>Yearly AMC Cost (₹)</label>
                <input type="number" step="0.01" name="yearly_cost">
            </div>

        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                Create AMC
            </button>
        </div>
    </form>
</div>

<!-- ✅ Proper gap (REAL) -->
<div style="height: 26px;"></div>

<div class="card">
    <h3>Active AMCs</h3>

    <table class="asset-table">
        <thead>
            <tr>
                <th>Asset ID</th>
                <th>Asset Name</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Days Left</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
            {% for amc in active_amcs %}
                <tr>
                    <td class="mono">{{ amc.asset.id }}</td>

                    <td class="asset-name">
                        {{ amc.asset.asset_name }}
                    </td>

                    <td>{{ format_date_indian(amc.start_date) }}</td>
                    <td>{{ format_date_indian(amc.end_date) }}</td>

                    <td>
                        <span class="days-left {{ amc_status_map[amc.id].key }}">
                            {{ amc_status_map[amc.id].days_left }}
                        </span>
                    </td>

                    <td>
                        {% set st = amc_status_map.get(amc.id) %}
                        {% if st %}
                            <span class="status-pill {{ st.key }}">
                                {{ st.label }}
                            </span>
                        {% endif %}
                    </td>

                    <td>
                        <a href="{{ url_for('amc_view', amc_id=amc.id) }}"
                           class="btn btn-secondary">
                            View
                        </a>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="7" class="muted-text">
                        No active AMC found
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if pagination %}
    <div class="pagination-bar">
        {% if pagination.has_prev %}
            <a class="btn btn-secondary" href="{{ url_for('amc_create', page=pagination.prev_num) }}">Prev</a>
        {% endif %}

        <span class="muted-text">
            Page {{ pagination.page }} of {{ pagination.pages }}
        </span>

        {% if pagination.has_next %}
            <a class="btn btn-secondary" href="{{ url_for('amc_create', page=pagination.next_num) }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>

{% endblock %}
